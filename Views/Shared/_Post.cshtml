@using AlphaBlogging.Models;

@model Post

  <h2>@Model.Title</h2>
  <p>@Model.Body</p>
  <p>post ID: @Model.Id</p>

@*<form asp-controller="Post" asp-action="UserClicksOnLike" method="post">

    <button type="submit" class="glyphicon glyphicon-thumbs-up" >@Model.Likes Likes></button>
    <input type="hidden" asp-for="Id" class="form-control" value="@Model.Id" />

</form>*@

@* <partial name="_LikePartial" model="Model.Likes" />
*@

<button id="LikeButton" onclick="UserclicksOnLikeJS(@Model.Id)">&#128077; @Model.Likes</button>



<div>
    @{
        
        if (Model.Tags != null)
        {
            <div class="row rounded m-3" >
            @foreach (var tag in Model.Tags)
            {
                <partial name="_TagPartial" model="tag" />
            }
            </div>
        }
        else
        {
            <p>no tags</p>
        }
    }


    @{
        if (  Model.Comments != null && Model.Comments.Count() > 0)
        {       
            @foreach (var comment in Model.Comments.Reverse())
            {
                <div>
                     <partial name="_Comment"  model="comment"/> 
                 
                    @Html.ActionLink("Add Comment", "Create", "Comment", new {postId = Model.Id} )


                </div>
                <hr />
           
            }
        }
        else
        {
            <h3>No comments yet</h3>        
        }
    }

</div>

    <script>
        //function LikeIncrease()
        //{
        //    var xhttp = new XMLHttpRequest();
        //    xhttp.onreadystatechange = function() 
        //    {
        //        if (this.readyState == 4 && this.status == 200) 
        //        {
        //            document.getElementById("demo").innerHTML =
        //            this.responseText;
        //        }
        //    };
        //    xhttp.open("GET", "ajax_info.txt", true);
        //    xhttp.send();
        //}
        function UserclicksOnLikeJS(bla)
        {

                $(document).ready(function () {
                $.ajax({
                    url: '@Url.Action("UserClicksOnLike", "Post")',
                    data: {Id:bla},
                    type: 'GET',
                    success: function(data) {
                        if (data) {  // check if data is defined
                           document.getElementById("LikeButton").innerHTML = "&#128077; " + (@Model.Likes+1);
                        }
                    }
                });
            });
        }

    </script>